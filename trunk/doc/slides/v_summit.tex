\documentclass{beamer}
\usepackage{subfigure}
%\usepackage{english}
\usepackage{graphics}
\usepackage{color}
\usepackage{textcomp}
\usepackage{url}
\graphicspath{./pics/}
% \usetheme{INET}

\usepackage{beamerthemeshadow}
% \beamersetuncovermixins{\opaqueness<1>{25}}{\opaqueness<2->{15}}

\title{Ringmap Capturing Stack for High Performance Packet Capturing in FreeBSD}
\author[Alexander Fiveg]{ Alexander Fiveg \\
\url{afiveg@freebsd.org} }
% \institute[TU Berlin/DT Labs]{Technische Universtit\"at Berlin \\ Deutsche Telekom Laboratories}

\begin{document}
\frame{\titlepage}

% Inhaltsverzeichnis
\section*{Outline}

\begin{frame}
\frametitle{Outline}
\tableofcontents
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% Worum es geht. Definition of Terms
\section{Motivation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
	\begin{center}
	\huge{Motivation}
	\end{center}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Problem}
\begin{frame}
\frametitle{Problem}
\textbf{Problems arising during packet capturing:}
\begin{itemize}
	\item High bit rates and packet rates
		\begin{itemize}
			\item [$\Rightarrow$] \textcolor{red}{high CPU load and packet loss} \newline
		\end{itemize}
\end{itemize}
\begin{figure}[H] 
	\subfigure{\includegraphics [width=0.45\textwidth]{plots/sysload_generic_slide}}
	\subfigure{\includegraphics [width=0.45\textwidth]{plots/pktlos_generic_slide}}
	\caption{Capturing 64-Bytes packets. (Bezier curves)}
\end{figure}
\end{frame}

\subsection*{The cause of the Problems}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{The reason of the Problems}
\textbf{Inefficiency of standard capturing software}\newline
\begin{itemize}
	\item To many ``expensive'' operations in terms of CPU cycles: 
\begin{itemize}
			\item System calls
			\item Packet copy operations
			\item Memory allocations
			\item etc\ldots\newline
\end{itemize}
% \begin{small}
% 	\item [$\Rightarrow$] probably the capturing software for FreeBSD was
% 		developed at a time when  network data-rates were low enough relative
% 		to hardware processing resources such that capturing loss problems did
% 		not arise?
% \end{small}
\end{itemize}
\end{frame}

\subsection*{Goal of the Project}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Goal of the project}
%\begin{large}
\textbf{Increase the capturing performance in FreeBSD}
	\begin{itemize}
		\item Design and implementation the new capturing software to
			minimize the \textbf{packet loss} and \textbf{CPU load} during capturing. \newline \newline
	\end{itemize}
%\begin{large}
\textbf{Supported Hardware:}
%\end{large}
\begin{itemize}
	\item The following \emph{Intel GbE Controllers:}
		\begin{itemize}
			\item \small{\emph{8254x, 8257x, 8259x}}
		\end{itemize}
%	\item Software:	\emph{FreeBSD}
\end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Approach}
\begin{itemize}
	\item<1-> Eliminating the packet copy operations
		\begin{itemize}
			\item<1-> by using shared memory buffers (\emph{memory \textbf{mapping}})\newline
		\end{itemize}
	\item<1-> Eliminating the memory allocations
		\begin{itemize}
			\item<1-> by using \textbf{ring} buffers\newline \newline
		\end{itemize}
	\item<2->[$\Rightarrow$] $ring + mapping = \textbf{ringmap}$
\end{itemize}
\end{frame}

\section{Solution}

\begin{frame}
	\begin{center}
	\huge{Solution}
	\end{center}
\end{frame}


\subsection*{The new capturing stack}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Ringmap Packet Capturing Stack}
\begin{itemize}
	\item \textbf{Ringmap}: The new packet capturing stack
	\item based on standard FreeBSD packet capturing stack: 		
		\begin{itemize}
			\item based on generic network drivers and \emph{libpcap}
			\begin{itemize}
				\item but slightly changed.\newline
			\end{itemize}
		\end{itemize}
\end{itemize}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
	\frametitle{What did we change in \emph{generic}}
\begin{columns}
\column[t]{0.5\textwidth}
\begin{itemize}
	\item <2->Disabled TCP/IP-Stack\newline
	\item <3->BPF is accessible in both kernel and user-space\newline
	\item <4->Network driver, BPF and Libpcap is modified\newline
\end{itemize}
\column[t]{0.5\textwidth}
\vspace{-2em}
\only<1>{\includegraphics [height=55mm,width=60mm]{pics/PCS_funcs_ziel_DA_0}}
\only<2>{\includegraphics [height=55mm,width=60mm]{pics/PCS_funcs_ziel_DA_1}}
\only<3>{\includegraphics [height=55mm,width=60mm]{pics/PCS_funcs_ziel_DA_2}}
\only<4>{\includegraphics [height=55mm,width=60mm]{pics/PCS_funcs_ziel_DA}}
\end{columns}
\end{frame}

\subsection*{From generic to ringmap}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
	\begin{center}
		\huge{From \emph{generic} to \emph{ringmap}}
	\end{center}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{From generic to ringmap}
\begin{columns}
\column[t]{0.5\textwidth}
\vspace{-1em}
\begin{itemize}
	\item<1->\textbf{generic}
	\item<2->Eliminate packet copies  and syscalls
	\item<3->BPF-Buffer is then not necessary
	\item<4->Mapping the Packet-Buffer to user-space
	\item<5->Move BPF to user-space\newline
	\item<6->[$\Rightarrow$]\textbf{ringmap}
\end{itemize}
\column[t]{0.5\textwidth}
\vspace{-2em}
\only<1>{\includegraphics [height=59mm,width=60mm]{pics/3copy}}
\only<2>{\includegraphics [height=59mm,width=60mm]{pics/3copy_solution_1}}
\only<3>{\includegraphics [height=59mm,width=60mm]{pics/3copy_solution_2}}
\only<4>{\includegraphics [height=59mm,width=60mm]{pics/3copy_solution_3}}
\only<5>{\includegraphics [height=59mm,width=60mm]{pics/3copy_solution_4}}
\only<6>{\includegraphics [height=59mm,width=60mm]{pics/3copy_solution_5}}
\end{columns}
\end{frame}

\subsection*{Overview}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Overview}
\begin{center}
\includegraphics [height=55mm,width=115mm]{pics/Ueberblick_new}
\end{center}
\end{frame}

\section{Performance evaluation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
	\begin{center}
	\huge{Measurements and performance evaluation}
	\end{center}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Goal of measurements}
\begin{itemize}
	\item Conducting performance evaluations of \textbf{ringmap} capturing stack
		\begin{itemize}
			\item CPU-Load and packet loss during capturing\newline
		\end{itemize}
	\item Benchmarking: \textbf{generic} vs. \textbf{ringmap}
\end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Measurement setup}
\textbf{Traffic generation}
\begin{itemize}
	\item Linux Kernel Packet Generator (\emph{pktgen})
		\begin{itemize}
			\item generates network packets at very high speed with different: 
				\begin{itemize}
					\item packet sizes
					\item bit-rate and packet-rate
				\end{itemize}
		\end{itemize}
\end{itemize}
\textbf{Capturing}
\begin{itemize}
	\item \textbf{ringmap} and \textbf{generic} stacks
	\item Libpcap-application
		\begin{itemize}
			\item accessing packets through call \emph{pcap\_loop()}
			\item counting the captured packets
		\end{itemize}
\end{itemize}
\end{frame}

\subsection*{Experiment description}

\subsection*{Results}
\begin{frame}
	\begin{center}
	\huge{Results}
	\end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{generic vs. ringmap: Packet loss}
\begin{center}
\includegraphics [height=0.81\textheight]{plots/pktloss_generic_vs_ringmap_mbs.eps}
\end{center}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{generic vs. ringmap: System-load}
\begin{center}
\includegraphics [height=0.81\textheight]{plots/sysload_generic_vs_ringmap_mbs.eps}
\end{center}
\end{frame}

\section{Summary}
\begin{frame}
	\begin{center}
	\huge{Summary}
	\end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Achieved goals}
\begin{itemize}
	\item \textbf{Enhanced Capturing-Performance}
		\begin{itemize}
			\item very low  system load (below $12\%$) and very low
				packet loss  (below  $0.02\%$)
				\begin{itemize}
					\item only during capturing smallest  64-Bytes packets
					\item for maximal reached packet-rate ($ > 450000 pkts/sec$)
				\end{itemize}
		\end{itemize}
	\item \textbf{Stability and usability of implemented software}
		\begin{itemize}
			\item during all experiments, no \emph{kernel panics} and no \emph{segmentation faults} occurred
			\item very simple install and remove
				\begin{itemize}
					\item two Shell-Scripts to installing  and removing the   
						\emph{ringmap} Capturing Stacks
				\end{itemize}
			\item Libpcap-applications don't require modification in order to run with the \emph{ringmap}
		\end{itemize}
\end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Achieved goals 2}
\begin{itemize}
	\item \textbf{Ringmap is easily portable to the other network controllers}
		\begin{itemize}
			\item The software contains hardware dependent and hardware
				independent parts. Only hardware dependent part require
				modifications.
			\item The generic driver and libpcap should contain a few hooks for calling
				\emph{ringmap}-functions.
		\end{itemize}
	\item \textbf{Packet Filtering}
		\begin{itemize}
			\item Packet filtering can be accomplished using both
				\emph{libpcap}- and kernel-BPF.
		\end{itemize}
\end{itemize}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Achieved goals 3}
\begin{itemize}
	\item \textbf{Multithreaded Capturing}
		\begin{itemize}
			\item Multiple applications can capture from the same interface. 
		\end{itemize}
	\item \textbf{Partly ported to the 10GbE controller}
		\begin{itemize}
			\item Currently only one queue is used while capturing. The work on
				supporting multiqueue is in progress.
		\end{itemize}
\end{itemize}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Future works}
\begin{enumerate}
	\item Benchmarking:  \textbf{Zero-Copy BPF} vs. \textbf{ringmap}
	\item Support for hardware time stamping
	\item Using TCP/IP stack together with \textbf{ringmap}
	\item 10-GbE-Paket-Capturing: Multiqueue + hardware support for packet filtering 
	\item Setting \textbf{ringmap} for packet transmission 
\end{enumerate}
\end{frame}

\end{document}
