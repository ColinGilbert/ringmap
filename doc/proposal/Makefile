# Generic make file for LaTeX: requires GNU make
#
# This makefile provides four targets: dvi, ps, pdf and clean.
# The default is "pdf".
# To make a dvi file, type "make dvi"
# To make a ps file, type "make ps".
# To make a pdf file, type "make pdf" or simply "make".
# To remove all files generated by make, type "make clean".
#
# Rouben Rostmaian
# September 2002

TEXFILE = main.tex

.PHONY: dvi ps pdf view print clean slides viewslides links

# dvi ps pdf view print clean : TEXFILE = draft.tex


INCLUDE_FILES = $(shell grep "include{" $(TEXFILE) | sed s/.\*include\{\\\(.*\\\)\}.\*/\\\1/ )
BIBFILES = $(shell grep "bibliography{" $(TEXFILE) | sed s/.\*bibliography\{\\\(.*\\\)\}.\*/\\\1/ | sed s/,/\ /  )


dvi:	$(TEXFILE:.tex=.dvi)
view:	dvi 
	xdvi $(TEXFILE:.tex=.dvi) &
pdf:	$(TEXFILE:.tex=.pdf)
ps:	$(TEXFILE:.tex=.ps)
print:  ps
	lpr $(TEXFILE:.tex=.ps)

ispell: $(TEXFILE) $(INCLUDE_FILES:%=%.tex)
	ispell -d american -t -M -L 3 $(TEXFILE)
	ispell -d american -t -M -L 3 $(INCLUDE_FILES:%=%.tex)

$(TEXFILE:.tex=.dvi) : $(TEXFILE) $(EPSFILES) $(INCLUDE_FILES:%=%.tex) $(TEXFILE:.tex=.bbl)

%.bbl:  %.tex $(BIBFILES:%=%.bib) 
	latex $<
	bibtex $(<:.tex=)

.tex.dvi: 
	latex $<
	while grep -q "Rerun to get cross-references right." $(<:.tex=.log); \
	do \
		latex $<; \
	done 

%.ps: %.dvi
	dvips -q -t a4 $<

%.pdf: %.ps
	ps2pdf -dPDFSETTINGS=/prepress $<

%.eps: %.dia
	dia -n -t eps-builtin -e $@ $<

clean:
	@rm -fv \
	$(TEXFILE:.tex=.aux) \
	$(TEXFILE:.tex=.log) \
	$(TEXFILE:.tex=.out) \
	$(TEXFILE:.tex=.dvi) \
	$(TEXFILE:.tex=.pdf) \
	$(TEXFILE:.tex=.ps) \
	$(TEXFILE:.tex=.bbl) \
	$(TEXFILE:.tex=.blg) \
	$(TEXFILE:.tex=.lof) \
	$(TEXFILE:.tex=.lot) \
	$(TEXFILE:.tex=.toc) \
	$(INCLUDE_FILES:%=%.aux) 
